**底层页品质感重构线上问题复盘**

## **问题1：在“日历详情页面地址”未下发的情况下追剧日历模块缺失

综艺的更新信息取自追剧日历，追剧日历由两个字段组成，一个是外显文案，另一个是点击后弹出的日历详情页。由于部分综艺没有配置日历详情页，新版本针对没有日历详情的case隐藏了追剧日历模块。

### **影响版本**

81 - 83
### **时间线**

​                ● **11月27日凌晨：pony反馈综艺未出现更新信息**

​                ● **11月22日早8点：收到反馈，开始排查。对比新老代码发现逻辑差异，更新时长和追剧日历用的是同一字段** **update_notify_****des****c****, 新版存在无法请求到日历跳转url的模块没有渲染的情况，去除过滤逻辑后修复**

​                ● **11月22日早8点50：修复完成，提交代码**

​                ● **11月22日早9点30：打好修复包，发布热更新**

### **问题出现原因**

旧的底层页项目中，非独立模块的追剧日历与简介模块耦合在一块；为了满足新需求，开发侧剥离并重新开发了独立的追剧日历模块。

在开发前的评审会上，开发和产品沟通时只确认了该模块是否可以点击，未确认不可点击时的情况是否展示；而在开发阶段时，误以为该新模块只能点击，把不能点击的当成异常数据过滤掉了，导致遗漏不可点击的追剧日历。

品质感重构测试、验收阶段，也没有做到完整地新老底层页对比，导致了该风险点的遗漏。

## **问题2：体育回放模块缺失**

测试反馈，体育品类的回放模块丢失 (https://tapd.woa.com/QQLive/bugtrace/bugs/view?bug_id=1000001150117640317&jump_count=1)

### **问题出现原因**

旧的底层页项目中，modules为剧集列表数据，旧底层页代码中对回放模块这种文字类型的多tab剧集列表，直接取了modules[0]进行数据渲染。

在品质感重构中，由于在eplisode_list模块前插入了一个追剧日历模块calendar，因此modules[0]取到的是错误的数据，没法渲染出正确的视频列表。


## **问题3：年份、类别、评分等信息缺失**



### **时间线**



​                ● **11月21日凌晨：pony反馈电影未出现年份、国家、语言等信息**

​                ● **11月22日早8点：收到反馈，开始排查问题，对比新老版本代码，发现是由于设计稿新版二级页中没有对应区域，代码中传递的** **areaYearGenres 字段未被使用，引发问题**

​                ● **11月22日早9点：修复完成，提交代码**

​                ● **11月22日早9点50：打好修复包，发布热更新**


### **问题出现原因**

旧的播放底层页，年份、类目等信息字段存在二级页中，没有外显出来，容易在设计和产品出稿子时被忽略。


品质感底层页二级页设计稿在外侧主页面和二级页都没有对应的区域展示年份相关信息，开发时按照设计稿实现，导致需求评审和开发阶段都忽略了这个点，留下了风险点。新设计稿

## **分析与总结**

### **经验和教训**

上述bug出现的**根本原因：**

​            \1.     在品质感重构需求拆解、样式设计阶段时，没有明确好重构前后版本的差异点和共同点；

​            \2.     需求评审阶段时，没有完整地沟通某个模块的交互逻辑；

​            \3.     测试用例评审阶段，没有完整地对重构前后的版本做对比测试，没及时发现遗留的差异点

**因此，后续再进行其他重构改版性质的项目时，必须保证做到如下几点：**

​                ● 需求评审时，必须将新的模块/页面与重构前的作对比，争议、改动的需求点详细列出来。

​                ● 开发阶段，有变更的模块必须理解老模块的实现逻辑，变化点都要一一明确，

​                ● 测试用例评审，须添加新老对比测试这一项，避免出现新老版本功能不一致的现象。

​                ● codeReview环节，重构某个feature时，一定要给之前负责该模块的同事进行cr。

​                ● 新增需求点、功能变更、bugfix，都要新建tapd单，方便后续溯源定位


​            \1.     年份、地区信息文案缺失，修复：https://git.woa.com/TencentVideoPC/EVOBundle/merge_requests/2936

​            \2.     缺失体育类目的回放模块，修复：https://git.woa.com/TencentVideoPC/EVOBundle/merge_requests/3005

​            \3.     缺失追剧日历模块，修复：https://git.woa.com/TencentVideoPC/EVOBundle/merge_requests/3005